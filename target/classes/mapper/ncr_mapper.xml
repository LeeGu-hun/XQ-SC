<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ncrSQL">

   <select id="getAuditList"  parameterType = "bean.NcrAuditSearchCommand" resultType="bean.NcrAuditListCommand">
   
      select a.audit_id,v.vendor_name,a.audit_comp_date,a.audit_kind_Id,ak.audit_kind,
      a.audit_result,a.auditor_id,m.member_name
      from audit_info a, vendor_info v, audit_kind ak, member_info m
      where a.vendor_id=v.vendor_id and a.audit_kind_Id=ak.audit_kind_id and a.auditor_id=m.member_id
      and v.vendor_name like '%'||#{vendorName}||'%'
      
    </select>  
  
  
	<insert id="ncrIssue" parameterType="bean.NcrBean">
      insert into ncr_info values((select count(*)from ncr_info)+1,#{audit_id},#{issuer_id},
      sysdate,null,null,#{ncr_title},#{ncr_description},#{ncr_grade_id})  
	</insert>
	
	<insert id="ncrFileUpload" parameterType="HashMap">
    INSERT INTO ncr_attach values((select count(*)from ncr_info),(select count(*)from ncr_attach)+1, #{originalfileName}, #{saveFileName},#{fileSize})
    </insert>

	
</mapper>
